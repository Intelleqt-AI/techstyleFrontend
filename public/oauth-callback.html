<!DOCTYPE html>
<html>
  <head>
    <title>OAuth Callback</title>
  </head>
  <body>
    <script>
      // Xero sends ?code=..., NOT #code=...
      const params = new URLSearchParams(window.location.search);
      const code = params.get('code');

      if (code && window.opener) {
        // Send the code back to the opener
        window.opener.postMessage(
          { type: 'OAUTH_SUCCESS', code },
          '*' // use origin if you want stricter security
        );

        // Give the browser a moment to postMessage before closing
        setTimeout(() => window.close(), 50);
      } else {
        document.body.innerText = 'OAuth Failed or Popup Blocked.';
        setTimeout(() => window.close(), 2000); // still close eventually
      }
    </script>
  </body>
</html>
